# 作用域链
## 作用域
### 1.全局作用域
- 定义在函数外部的对象作用域
- 函数内部没有声明的也是全局作用域
- 所有的全局变量都会声明提前

```
<script type="text/javascript">
  	alert(a);//undefined
	var a = "李四";
</script>
```
###  2.局部作用域
- 定义在函数内部的对象的作用域
- 形参的作用域也是局部作用域
## 作用域链
顾名思义，就是由作用域组成的链，是一个类似链状的数据结构。作用域就是对上下文环境(执行环境)的数据描述

---
执行环境定义了变量或函数有权访问的其他数据，决定了它们各自的行为。每个执行环境都有一个与之关联的 变量对象（variable object），环境中定义的所有变量和函数都保存在这个对象中。

---
 在函数执行过程中，每遇到一个变量，都会检索从哪里获取和存储数据，该过程从作用域链头部，也就是从活动对象开始搜索，查找同名的标识符，如果找到了就使用这个标识符对应的变量，如果没有则继续搜索作用域链中的下一个对象，如果搜索完所有对象都未找到，则认为该标识符未定义，函数执行过程中，每个标识符都要经历这样的搜索过程。
 
```
function sayName(name){
    return name;
}
var say = sayName('jozo');
```
这段代码包含两个作用域：a.全局作用域；b.sayName函数的作用域，也就是只有两个变量对象，当执行到对应的执行环境时，该变量对象会成为活动对象，并被推入到执行环境作用域链的前端，也就是成为优先级最高的那个。 看图说话：

---
![image](http://note.youdao.com/noteshare?id=7fe5b75759604e63137b48bcb46b517e&sub=69814A2E14CB47E085673ABE6343C48A)
## 闭包
- 只有函数内部的子函数才能读取局部变量，因此可以把闭包简单理解成"定义在一个函数内部的函数"。
- 在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁

### 闭包的特点:
- 1.可以访问外层函数的局部变量
- 2.读取的局部变量的值一定是最终的值

---
### 闭包的应用:
#### 1.封装私有对象

```
 var p = (function () {
        var person = {
            name: "王二麻子",
            height:160,
            sex: "不明"
        }
        return {
            getName : function () {
                return person.name;
            },
            setName : function (name) {
                person.name = name;
            },
            setHeight : function (height) {
                if(height > 200 || height < 100){
                    throw  Error("发育不良或者是激素吃多了!!!")
                }else{
                    person.height = height;
                }
            }
        }
    })();

    console.log(p.getName());
    p.setHeight(80);
```
#### 2.匿名函数的自执行

```
(function () {
	alert("匿名函数自执行")
    
})();
```
#### for循环的问题

```
<body>
	<input type="button" value="按钮1"	>
	<input type="button" value="按钮2"	>
	<input type="button" value="按钮3"	>
	<script type="text/javascript">
		var btns = document.getElementsByTagName("input");
		for (var i = 0; i < 3; i++) {
			btns[i].onclick = function () {
				alert("我是第" + (i + 1) + "个按钮");
			};
		}
	</script>
</body>
```
发现在点击三个按钮的时候都是弹出 我是第4个按钮。	为什么呢？闭包导致的！ 每循环一次都会有一个匿名函数设置点击事件，闭包总是保持的变量的最后一个值，所以点击的时候，总是读的是 i 的组后一个值4

---
- 解决方法1:

```
<script>
    var btns = document.getElementsByTagName("button");
    for(var i = 0; i < btns.length; i++){
        btns[i].index = i;
        btns[i].onclick = function () {
            console.log(this.index);
        }
    }

</script>
```
- 解决方法2:
 
```
<script type="text/javascript">
		var btns = document.getElementsByTagName("input");
		for (var i = 0; i < 3; i++) {	
			(function (num) {
				btns[i].onclick = function () {
					console.log(num);
				}
			})(i);
		}
	</script>
```


